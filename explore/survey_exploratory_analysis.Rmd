---
title: "Analysis of PGY1 Interviews for 2018-2019"
author: "Brian Gulbis"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output:
  html_document:
    code_folding: hide
    fig_caption: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
```

```{r data, message=FALSE}
library(tidyverse)
library(readxl)
library(themebg)

survey <- read_excel("../data/raw/2018_survey_responses.xlsx") %>%
    mutate_at(
        c("OriginalResponse", "ShortAnswer"), 
        na_if, 
        y = "NA"
    ) 

ratings <- read_excel("../data/raw/2018_interview_interactions.xlsx")

group <- read_excel("../data/raw/2018_responder_group.xlsx")

mh_ranking <- survey %>%
    filter(Question == 4) %>%
    mutate_at(
        "ShortAnswer", 
        factor,
        levels = c(
            "First Choice", 
            "Second Choice",
            "Third Choice or Below",
            "Did Not Rank"
        ), 
        ordered = TRUE
    )

```

## How candidates ranked our program

```{r, fig.cap="Where Respondants Ranked Us"}
ggplot(mh_ranking, aes(x = ShortAnswer)) +
    geom_bar() +
    xlab(NULL) +
    ylab("Number of Responses") +
    theme_bg(xticks = FALSE)
```

## Reasons why we were not first choice

```{r}
survey %>%
    filter(
        Question == 5, 
        !is.na(OriginalResponse)
    ) %>%
    select(-ShortAnswer) %>%
    left_join(
        mh_ranking[c("Responder", "ShortAnswer")], 
        by = "Responder"
    ) %>%
    select(
        Rating = ShortAnswer, 
        Comments = OriginalResponse
    ) %>%
    arrange(Rating) %>%
    knitr::kable("html", booktabs = TRUE) %>%
    kableExtra::collapse_rows()

```

## Ratings for each component of your interview day

```{r, fig.width=8, fig.cap="How Respondants Rated Each Portion of Interview Day"}
ratings %>%
    mutate_at(
        "Score", 
        factor, 
        levels = c(
            "Excellent", 
            "Above Average",
            "Average", 
            "Below Average"
        ), 
        ordered = TRUE
    ) %>%
    ggplot(aes(x = Score)) +
    geom_bar() +
    xlab("Rating") +
    ylab("Number of Responses") +
    facet_wrap(~ Attribute) +
    coord_flip() +
    theme_bg(yticks = FALSE)
```

## Most important factors when deciding what order to rank residency programs

```{r}
survey %>%
    filter(
        Question == 2, 
        !is.na(OriginalResponse)
    ) %>%
    select(-ShortAnswer) %>%
    left_join(
        mh_ranking[c("Responder", "ShortAnswer")], 
        by = "Responder"
    ) %>%
    select(
        Rating = ShortAnswer,
        Comments = OriginalResponse
    ) %>%
    arrange(Rating) %>%
    knitr::kable("html", booktabs = TRUE) %>%
    kableExtra::collapse_rows()
```

## Did they attend the happy hour

```{r, fig.cap="Did they attend the happy hour"}
survey %>%
    filter(
        Question == 6,
        !is.na(OriginalResponse)
    ) %>%
    ggplot(aes(x = OriginalResponse)) +
    geom_bar() +
    xlab(NULL) +
    scale_y_continuous(
        "Number of Respones", 
        breaks = seq(0, 22, by = 2)
    ) +
    theme_bg(yticks = FALSE)
```

## Did the happy hour enhance the interview experience

```{r}
survey %>%
    filter(
        Question == 7, 
        !is.na(OriginalResponse)
    ) %>%
    select(-ShortAnswer) %>%
    left_join(
        mh_ranking[c("Responder", "ShortAnswer")], 
        by = "Responder"
    ) %>%
    select(
        Rating = ShortAnswer,
        Comments = OriginalResponse
    ) %>%
    arrange(Rating) %>%
    knitr::kable("html", booktabs = TRUE) %>%
    kableExtra::collapse_rows()
```

## How candidates first learned of our program

```{r, fig.cap="How candidates learned of our program"}
survey %>%
    filter(Question == 1, !is.na(ShortAnswer)) %>%
    mutate_at("ShortAnswer", fct_infreq) %>%
    ggplot(aes(x = ShortAnswer)) +
    geom_bar() +
    xlab(NULL) +
    ylab("Number of Respones") +
    coord_flip() +
    theme_bg(yticks = FALSE)
```


## Provide any suggestions to improve the interview process

```{r}
survey %>%
    filter(
        Question == 8, 
        !is.na(OriginalResponse)
    ) %>%
    select(-ShortAnswer) %>%
    left_join(
        mh_ranking[c("Responder", "ShortAnswer")], 
        by = "Responder"
    ) %>%
    select(
        Rating = ShortAnswer,
        Comments = OriginalResponse
    ) %>%
    arrange(Rating) %>%
    knitr::kable("html", booktabs = TRUE) %>%
    kableExtra::collapse_rows()
```
